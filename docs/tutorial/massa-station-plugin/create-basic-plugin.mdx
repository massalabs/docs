---
id: create-plugin-1
title: Create a basic plugin
---

This part will show you how to create a basic plugin that simply displays a message.

## Define your plugin

- Define an API for the plugin that will allow Massa Station to interact with it.

  - Set up the api folder: create `api/server`
  - Create a file named `swagger.yml` in the api folder
  - Initialize it with the following basic configuration:

  ```yaml
  consumes:
    - application/json
  info:
    description: Hello world plugin API.
    title: station-massa - Hello world
    version: 0.0.0
  produces:
    - application/json
  schemes:
    - http
  swagger: "2.0"
  paths:
    /:
      get:
        operationId: defaultPage
        responses:
          "301":
            description: Move to the default endpoint
  ```

  :::info

  Here we simply defined a default endpoint that will be called when the plugin is called without any endpoint specified.
  This will be used to display a frontend in the [part 3 of the tutorial](./create-plugin-with-a-frontend.mdx).

  :::

  :::tip
  We will add more endpoints in the [part 2 of the tutorial](./create-plugin-with-endpoint.mdx). Feel free to addapt the swagger file to your needs.
  For a detailed understanding of the API specification and how to edit it, refer to the [official swagger v2 documentation](https://swagger.io/specification/v2/).

  :::

- Create a `generate.go` file: in the root of your project

  :::tip

  this file will generate the API from the swagger file when you run `go generate ./... `

  :::

- Add the following code to it:

  ```go
  package main

  //go:generate swagger generate server --quiet --target api/server --name my-plugin --spec api/swagger.yml --exclude-main
  ```

- Run `go generate ./...` to generate the API

## Implement your plugin

Create `my-plugin.go` in the root of your project and add the following code to initiate the API:

```go
package main

import (
	"fmt"
	"net/http"
	"os"
	"os/signal"
	"syscall"
	"time"

	"my-plugin/api/server/restapi"
	"my-plugin/api/server/restapi/operations"

	"github.com/go-openapi/loads"
	"github.com/massalabs/station-massa-hello-world/pkg/plugin"
	"github.com/rs/cors"
)

func killTime(quit chan bool) { // creates a ticker that will send a message every 5 seconds
  // creates a ticker that will send a message every 5 seconds
	ticker := time.NewTicker(5 * time.Second) //nolint:gomnd

	fmt.Fprintf(os.Stdout, "Plugin is initializing.\n")

	for {
		select {
		case <-ticker.C:
			fmt.Fprintf(os.Stdout, "Tic!\n") // logs a message every 5 seconds
		case <-quit:
			fmt.Fprintf(os.Stdout, "Plugin is shutting down.\nBye!\n") // logs a message when the plugin is shutting down

			return
		}
	}
}

func initializeAPI() *restapi.Server {
    swaggerSpec, err := loads.Analyzed(restapi.SwaggerJSON, "") // loads the swagger file
    if err != nil {
        panic(err)
    }

    pluginAPI := operations.NewMyPluginAPI(swaggerSpec) // initializes the API
    server := restapi.NewServer(pluginAPI) // creates the server

    server.ConfigureAPI() // configures the API

    return server
}
```

:::info

The `killTime` function logs a message every 5 seconds. It is used to show that the plugin is running.
The `initializeAPI` function initializes the API and returns the server.

:::

- Still in `my-plugin.go`, set up the cors: the cors will allow the plugin to be called from the Massa Station server.

```go
func setupGlobalMiddleware(handler http.Handler) http.Handler {
    handleCORS := cors.New(cors.Options{}).Handler

    return handleCORS(handler)
}
```

- Import the necessary packages `go mod tidy`
- Add the `main` function in `my-plugin.go`: it initializes the API and start the server

```go
func main() {
    quit := make(chan bool) // creates a channel to receive the interrupt signal
	intSig := make(chan os.Signal, 1) // notifies the channel when the interrupt signal is received
	signal.Notify(intSig, syscall.SIGINT, syscall.SIGTERM)

	go killTime(quit) // starts the killTime function in a goroutine

	server := initializeAPI() // initializes the API

	if err := server.Serve(); err != nil {
		panic(err)
	}

	<-intSig
	quit <- true
}
```

- Run the API on a local server to test and validate its functionality.

```bash
go run ./my-plugin.go
```

- You should get the following output:

```bash
2023/07/24 16:02:51 Serving hello world at http://[::]:41701
Tic!
```

:::tip
The last numbers correspond to the port the API is running on. It will change each time you will restart the plugin.
:::

## Deploy on Massa Station

### Register the plugin

To do so, in `my-plugin.go`:

- Import the plugin package. `github.com/massalabs/station-massa-hello-world/pkg/plugin`
- Update the packages in `go.mod`: `go get github.com/massalabs/station-massa-hello-world`
- Listen to the server created and register the plugin with the `RegisterPlugin` function from the plugin package.

```go
	listener, err := server.HTTPListener()
	if err != nil {
		panic(err)
	}

	plugin.RegisterPlugin(listener,plugin.Info{}) // registers the plugin
```

:::info
`plugin.RegisterPlugin` is a function available in the [plugin package](https://github.com/massalabs/station-massa-hello-world/blob/main/pkg/plugin/register.go).

It facilitates the registration of a plugin with Massa Station, assigning a unique correlation ID to the plugin for identification purposes within the Massa Station system.

:::

### Install the plugin

Build a binary of the plugin. `mkdir build && go build -o build/my-plugin`

Move the plugin binary, the manifest and the swagger file to the Massa Station plugin folder.

:::tip

On linux or macOS you can use the following command to move the files:

```bash
mkdir -p /usr/local/share/massastation/plugins/my-plugin
cp build/my-plugin /usr/local/share/massastation/plugins/my-plugin
cp web/content/hello_world.svg /usr/local/share/massastation/plugins/my-plugin
cp manifest.json /usr/local/share/massastation/plugins/my-plugin
```

On Windows, you can use the following command in the PowerShell:

```powershell
# Create the directory
$destinationDir = "C:\Program Files (x86)\MassaStation\plugins\my-plugin"
New-Item -ItemType Directory -Force -Path $destinationDir

# Copy the files
$sourceDir = "build\my-plugin"
Copy-Item $sourceDir\my-plugin $destinationDir -Force

$sourceDir = "web\content"
Copy-Item $sourceDir\hello_world.svg $destinationDir -Force

Copy-Item manifest.json $destinationDir -Force
```

:::

Run Massa Station and access [the module page](https://station.massa/web/store). You should see the plugin in the list of available plugins.
![image](./massastation-menu.png)
