<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-learn/asc/massa-asc">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.0">
<title data-rh="true">Massa&#x27;s Autonomous Smart Contracts | Massa Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.massa.net/docs/learn/asc/massa-asc"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Massa&#x27;s Autonomous Smart Contracts | Massa Documentation"><meta data-rh="true" name="description" content="Here we will explain how Massa&#x27;s Autonomous Smart Contracts work by constructing all their features step by step."><meta data-rh="true" property="og:description" content="Here we will explain how Massa&#x27;s Autonomous Smart Contracts work by constructing all their features step by step."><link data-rh="true" rel="icon" href="/img/logo.svg"><link data-rh="true" rel="canonical" href="https://docs.massa.net/docs/learn/asc/massa-asc"><link data-rh="true" rel="alternate" href="https://docs.massa.net/docs/learn/asc/massa-asc" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.massa.net/docs/learn/asc/massa-asc" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://HXTTWBHG5G-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Massa Documentation RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Massa Documentation Atom Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Massa Documentation" href="/opensearch.xml">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.29ccf093.css">
<link rel="preload" href="/assets/js/runtime~main.4d3800eb.js" as="script">
<link rel="preload" href="/assets/js/main.bf8eda85.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/massa_logo.svg" alt="Massa Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/massa_logo_white.svg" alt="Massa Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Docs</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/learn/home">🎓 Learn</a><a class="navbar__item navbar__link" href="/docs/build/home">🛠️ Build</a><a class="navbar__item navbar__link" href="/docs/tutorial/home">📖 Tutorial</a><a class="navbar__item navbar__link" href="/docs/node/home">🖥 Mainnet</a><a class="navbar__item navbar__link" href="/docs/massaStation/home">🧩 Massa Station</a><a class="navbar__item navbar__link" href="/docs/massaBridge/home">🌉 Massa Bridge</a><a class="navbar__item navbar__link" href="/docs/deweb/home">🌐 Massa DeWeb</a></div><div class="navbar__items navbar__items--right"><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/learn/home">Home</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1"><hr></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1"><span class="menu__link"><b><small> Massa Blockchain </small></b></span></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/learn/introduction">Welcome to Massa</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/learn/architecture/basic-concepts">Basic concepts</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/docs/learn/architecture/node-architecture">Node Architecture</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/learn/tokenomics">Tokenomics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/learn/bootstrap">Bootstrapping in Massa</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/learn/storage-costs">Storage costs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/learn/gas">Gas</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/learn/operation-format-execution">Detailed operation format and execution sequence</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1"><hr></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1"><span class="menu__link"><b><small>Autonomous Smart Contracts</small></b></span></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/learn/asc/intro">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" href="/docs/learn/asc/massa-asc">Autonomous Smart Contracts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1"><hr></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1"><span class="menu__link"><b><small>Decentralized Web</small></b></span></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/learn/decentralized-web">Decentralized Web</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Autonomous Smart Contracts</span><meta itemprop="position" content="1"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Massa&#x27;s Autonomous Smart Contracts</h1><p>Here we will explain how Massa&#x27;s Autonomous Smart Contracts work by constructing all their features step by step.
Make sure you have read the <a href="/docs/learn/asc/intro">introduction to Autonomous Smart Contracts</a> before diving into the details.</p><p>Massa provides three features that enable smart contracts to operate autonomously:</p><ul><li>an absolute clock</li><li>async messages: those resemble normal user-emitted operations but can be emitted by smart contracts in order to execute something in the future</li><li>deferred calls: a way to schedule a future call</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-clock-massa-is-a-timed-blockchain">The clock: Massa is a timed blockchain<a href="#the-clock-massa-is-a-timed-blockchain" class="hash-link" aria-label="Direct link to The clock: Massa is a timed blockchain" title="Direct link to The clock: Massa is a timed blockchain">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="slots-and-block-execution">Slots and block execution<a href="#slots-and-block-execution" class="hash-link" aria-label="Direct link to Slots and block execution" title="Direct link to Slots and block execution">​</a></h3><p>In Massa, time is divided in 0.5 second intervals through Slots (see <a href="/docs/learn/architecture/basic-concepts">the basic concepts</a>.
Slots are absolute points in time: the first slot happened at the genesis timestamp (<code>15/01/2024 12:00:00 UTC</code>) and there is one slot every 0.5 second since genesis.</p><p>At each slot, a block producer is selected to produce a block.
The block producer picks operations from the pool of non-executed operations (&quot;mempool&quot;) that it has observed propagating in the network, and includes them in their block for execution.
If the blocks are full, pending operations are competing for resources, and therefore block producers will prioritize operations that bring them higher fees compared to the resources they occupy.</p><p>See <a href="/docs/learn/architecture/basic-concepts">the basic concepts</a> and <a href="/docs/learn/architecture/operation-lifecycle">the operation lifecycle</a> for more details.</p><p><img loading="lazy" alt="Slots in Massa" src="/assets/images/massa_slots-cc1703fef55226982f9e137c4859abed.png" width="924" height="697" class="img_ev3q"></p><p>When the time of a slot is reached, that slot is executed by all nodes.</p><p>During the execution of a slot, the block produced for that slot is executed by all nodes.
It can happen that the block producer did not produce their block, in which case no block is executed during the execution of the slot (it&#x27;s a &quot;miss&quot;).
When a block is executed, the operations it contains are executed in the order they were included in the block.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="operations-in-massa">Operations in Massa<a href="#operations-in-massa" class="hash-link" aria-label="Direct link to Operations in Massa" title="Direct link to Operations in Massa">​</a></h3><p>Here is what a typical operation in Massa looks like:</p><p><img loading="lazy" alt="Transaction in Massa" src="/assets/images/massa_tx-58ba8807248df7f262b9f07be6482cf1.png" width="445" height="385" class="img_ev3q"></p><p>It contains:</p><ul><li>a Fee (tip) given to block producers to motivate them to include the operation in their block and limit flooding,</li><li>validity conditions (validity start and end slots) to ensure the operation is executed only in a specific time window,</li><li>info on resource usage, typically the amount of gas consumed by the operation,</li><li>the payload which can be the execution of a smart contract or a simple transfer of tokens.</li></ul><p>Read about <a href="/docs/learn/architecture/operation-lifecycle">the operation lifecycle</a> for more details.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="having-users-race-for-automation">Having users race for automation<a href="#having-users-race-for-automation" class="hash-link" aria-label="Direct link to Having users race for automation" title="Direct link to Having users race for automation">​</a></h3><p>One trick used by some protocols to achieve decentralized automation is to let users race and pay the first one that manages to trigger an expected call.
Public race is typically used in lending protocols in which users race to detect under-collateralized positions and send operations to liquidate them, pocketing a reward.</p><p>This approach works on Massa as well, but it has several limitations:</p><ul><li>it only works for suitable use cases in which there is a reward for users</li><li>it inherits of the usual limitations of operations: the need for private keys and signing, the need to pay fees, potential delays, etc.</li></ul><p>Another problem is that having many users race can result in many operations being sent to the network by many users at the same time, which can cause overload issues.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="async-messages-allowing-smart-contracts-to-emit-operation-like-messages">Async messages: allowing smart contracts to emit operation-like messages<a href="#async-messages-allowing-smart-contracts-to-emit-operation-like-messages" class="hash-link" aria-label="Direct link to Async messages: allowing smart contracts to emit operation-like messages" title="Direct link to Async messages: allowing smart contracts to emit operation-like messages">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="general-idea">General idea<a href="#general-idea" class="hash-link" aria-label="Direct link to General idea" title="Direct link to General idea">​</a></h3><p>Why would only external users be allowed to emit operations?
The idea is that if we allow smart contracts to emit something that looks like operations (we call those &quot;Async Messages&quot;),
they could schedule future calls to themselves or to other smart contracts in order to achieve autonomy.</p><p>Here is how it works:</p><p><img loading="lazy" alt="Async message execution in Massa" src="/assets/images/async_msg_system-6c5c96a7682c255743241286b1383add.png" width="1389" height="515" class="img_ev3q"></p><p>When a smart contract is executed, it can emit async messages that will be sent to a separate mempool which,
contrary to the classical mempool, is deterministic and synchronized between all nodes.
All nodes see exactly the same autonomous mempool at each final slot.</p><p>When a slot is executed, nodes start by executing the block it contains (if any).
Then, all nodes pick async messages that are ready to execute from the autonomous mempool and execute them by prioritizing them by the same criteria that block producers use for operations:
fee vs resource (gas) usage.
Just like for block production, the available gas for async message execution is limited within a slot.
The difference here is that all nodes pick exactly the same async messages to execute at the end of the slot, through an automated algorithm that ensures that all nodes stay in sync.
This means that async messages can get executed at a given slot even if there was no block produced at that slot.</p><p>A smart contract executed by an operation or an async message can in turn emit more async messages.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="async-message-structure">Async message structure<a href="#async-message-structure" class="hash-link" aria-label="Direct link to Async message structure" title="Direct link to Async message structure">​</a></h3><p>Here is what an async message looks like:</p><p><img loading="lazy" alt="Async message in Massa" src="/assets/images/async_msg-ef915c5830da9ba56cac39f1b3007cff.png" width="533" height="461" class="img_ev3q"></p><p>It resembles a normal operation as it contains:</p><ul><li>A Fee (tip) that is <strong>fully burned</strong> because anti-flood is needed, but since inclusion is deterministic, there is no need to incentivize block producers. All token holders profit from the burn.</li><li>Validity conditions can be one or all of the following:<ul><li>start and end validity slots: the async message can only be executed in a specific time window</li><li>require a specific entry to change in the blockchain to enable the message: this is useful to only trigger the message when a specific on-chain event happens</li></ul></li><li>Info on resource usage: here only gas usage.</li><li>The payload describing the call of a smart contract function. The contents match those of a <code>CallSC</code> operation (<code>target_address</code>, <code>target_function</code>, <code>parameters</code>, <code>coins</code>). Read about <a href="/docs/learn/architecture/operation-lifecycle">the operation lifecycle</a> for more details.</li></ul><p>When an async message is emitted by a smart contract, <code>fee + coins</code> are taken away from the smart contract&#x27;s balance.
<code>fee</code> is burned (see above) and <code>coins</code> is locked in the message to be used as the <code>coins</code> parameter for calling the target smart contract function when the message is executed in the future.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-power-of-async-messages-in-massa">The power of Async Messages in Massa<a href="#the-power-of-async-messages-in-massa" class="hash-link" aria-label="Direct link to The power of Async Messages in Massa" title="Direct link to The power of Async Messages in Massa">​</a></h3><p>Async messages are executed independently of blocks.
This means that smart contracts in Massa do not need block executions to run over time: they can live by themselves.
This is possible because the full async message lifecycle is on-chain, deterministic and synchronized between all nodes:
every node knows exactly how each smart contract should evolve in time.</p><p>In other words, blocks in Massa are just a way to ensure security and to inject data and user requests from the outside world into the blockchain,
but the smart contracts themselves can live and evolve autonomously within the blockchain.</p><p>This also means that, just like normal users do for operations, smart contracts in Massa need to be handling the fee payments for the async messages they emit. </p><p>Also, contrary to operations, there no need to handle private keys and signing!</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="limitations-of-async-messages">Limitations of Async Messages<a href="#limitations-of-async-messages" class="hash-link" aria-label="Direct link to Limitations of Async Messages" title="Direct link to Limitations of Async Messages">​</a></h3><p>Async messages are inspired by operations, and therefore they are subject to some of their limitations:</p><ul><li>In case of congestion of the autonomous mempool, the fee of the async message will determine its priority for execution. This means that if the fee is too low, the message execution might be delayed or not happen at all.</li><li>If the async message expires without having been executed, it is dropped from the autonomous mempool and the locked <code>coins</code> are sent back to the smart contract that emitted the async message.</li><li>If the autonomous mempool is full, the lowest priority async messages (lowest fee over gas ratio) are dropped from the mempool and the locked <code>coins</code> are sent back to the smart contract that emitted the async message. They won&#x27;t be executed.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="deferred-calls-scheduling-future-calls-with-guaranteed-execution">Deferred calls: scheduling future calls with guaranteed execution<a href="#deferred-calls-scheduling-future-calls-with-guaranteed-execution" class="hash-link" aria-label="Direct link to Deferred calls: scheduling future calls with guaranteed execution" title="Direct link to Deferred calls: scheduling future calls with guaranteed execution">​</a></h2><p>As a complementary solution to async messages, Massa also provides a way for smart contracts to schedule future calls,
but this time with a full guarantee that not only the scheduled execution will happen, but also that it will happen exactly at the slot decided by the smart contract.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="general-description">General description<a href="#general-description" class="hash-link" aria-label="Direct link to General description" title="Direct link to General description">​</a></h3><p>Deferred calls work in a fundamentally different way compared to async messages and provide different advantages and drawbacks.
Here is an overview:</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-are-deferred-calls-scheduled">How are deferred calls scheduled?<a href="#how-are-deferred-calls-scheduled" class="hash-link" aria-label="Direct link to How are deferred calls scheduled?" title="Direct link to How are deferred calls scheduled?">​</a></h3><p>A smart contract can schedule a deferred call in two steps:</p><ul><li>step 1: the smart contract requests a quote to schedule the call at a given future slot and provides the call parameter length and max amount of gas necessary for the call.
The system tells the smart contract whether there is still enough gas available at the desired slot, and the fee the smart contract would need to burn to schedule the requested call.</li><li>step 2: if the smart contract agrees with the quote, it pays the quoted fee and any call coins, and the system schedules the call for the desired slot.</li></ul><p>Here are more details:</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-1-requesting-a-quote">Step 1: Requesting a quote<a href="#step-1-requesting-a-quote" class="hash-link" aria-label="Direct link to Step 1: Requesting a quote" title="Direct link to Step 1: Requesting a quote">​</a></h3><p>To schedule a future call, a smart contract needs to request a quote from the system with the following parameters:</p><ul><li>the target slot at which the call should happen</li><li>the max amount of gas the call will need</li><li>the size of the arguments to pass to the called function</li></ul><p>The system then performs the following steps:</p><ul><li>If the target slot is at the current slot or the past, or too much in the future (later than <code>DEFERRED_CALL_MAX_FUTURE_SLOTS</code> slots from now), the quote is rejected.</li><li>At each slot, there is <code>DEFERRED_CALL_MAX_ASYNC_GAS</code> assigned for deferred calls. If, given the already scheduled deferred calls at the target slot, there is not enough gas left for the new call, the quote is rejected.</li><li>A fee is automatically calculated and returned by the system using an algorithm inspired by airplane transport pricing:<ul><li>there is a base fee that is adjusted slowly over time based on the average usage to respond to market changes</li><li>the fee increases with the amount of gas requested</li><li>the fee increases with the occupancy of the target slot</li><li>the fee increases with the average occupancy of all slots currently available for reservation</li><li>there is an extra fee for storing the arguments of the call in the state according to the logic given by <a href="/docs/learn/storage-costs">storage costs</a>. This charge is refunded to the emitter of the deferred call when the deferred call is removed from the state (eg. when it is executed).</li></ul></li></ul><p><img loading="lazy" alt="Deferred calls: quote step" src="/assets/images/deferred_call_quote-48293f05406b301dc5e943840cb1eaec.png" width="1213" height="503" class="img_ev3q"></p><p>If the quote does not match the expectations of the smart contract,
it can quote again at a different slot or different parameters, or simply trigger some notification or backup mechanism.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="step-2-registering-a-deferred-call">Step 2: Registering a deferred call<a href="#step-2-registering-a-deferred-call" class="hash-link" aria-label="Direct link to Step 2: Registering a deferred call" title="Direct link to Step 2: Registering a deferred call">​</a></h3><p>If the smart contract agrees with the quote, it can request the registration of the deferred call by providing:</p><ul><li>the slot at which the call should happen</li><li>the max amount of gas the call will need</li><li>the target smart contract address to call</li><li>the target function name to call</li><li>the parameters of the function to call</li><li><code>coins</code> to pass for the call</li></ul><p>If the deferred call is valid and the target slot is properly available (i.e. a quote would not return a rejection, see above),
the system spends <code>fee + coins</code> from the smart contract balance and schedules the call for the target slot.
The <code>fee</code> is burned and the <code>coins</code> are locked in the deferred call.</p><p><img loading="lazy" alt="Deferred calls: quote step" src="/assets/images/deferred_call_register-715e282a7c3cd3e0b317755f0b2a9763.png" width="1216" height="508" class="img_ev3q"></p><p>Once registered, the deferred call is guaranteed to be executed at the target slot by all nodes, independently of blocks and async messages.
After registration, a unique ID of the deferred call is returned to the smart contract.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-are-deferred-calls-executed">How are deferred calls executed?<a href="#how-are-deferred-calls-executed" class="hash-link" aria-label="Direct link to How are deferred calls executed?" title="Direct link to How are deferred calls executed?">​</a></h3><p>During the execution of a slot, executions happen in the following order:</p><ul><li>first the deferred calls scheduled for that slot are executed (if any)</li><li>then the block produced for that slot is executed (if any)</li><li>then, any async messages that are ready to execute (if any) are executed as long as there is enough remaining slot gas to fill all the available slot gas that was not used by the block or deferred calls.</li></ul><p><img loading="lazy" alt="Deferred calls execution" src="/assets/images/deferred_calls_general-c8bda1b6a1fe87b495943772ed793d8b.png" width="1391" height="603" class="img_ev3q"></p><p>Just like async messages, deferred calls are executed independently of blocks.</p><p>When a deferred call is executed, the <code>coins</code> locked in the call are used as the <code>coins</code> parameter for calling the target smart contract function.
The storage costs for the arguments of the call are sent back to the smart contract that registered the deferred call.</p><p>In case of execution failure (non-existent target address/function, VM runtime error...), the <code>coins</code> locked in the deferred call are sent back to the smart contract that registered the deferred call.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="cancellation">Cancellation<a href="#cancellation" class="hash-link" aria-label="Direct link to Cancellation" title="Direct link to Cancellation">​</a></h3><p>Smart contracts can decide to to cancel the execution of a deferred call they registered at any time before the target slot is reached.
To do this, a smart contract can request the cancellation of a deferred call by providing its unique ID.
When cancellation is requested, the <code>coins</code> of the call are sent back to the smart contract that registered the deferred call, but the <code>fee</code> is not refunded.
Also note that, in order to avoid any manipulation of the predictive fee market,
the occupancy of the target slot is not updated when a deferred call is canceled and remains the same, as if the deferred call was still there.
At the moment the call would have been executed if it weren&#x27;t canceled, the coins locked for storing the function arguments are sent back to the caller.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-power-of-deferred-calls-in-massa">The power of Deferred Calls in Massa<a href="#the-power-of-deferred-calls-in-massa" class="hash-link" aria-label="Direct link to The power of Deferred Calls in Massa" title="Direct link to The power of Deferred Calls in Massa">​</a></h3><p>Deferred calls are extremely powerful because they provide a way for smart contracts to schedule future calls with a full guarantee of execution.
This means that smart contracts can rely on deferred calls to perform actions at an exact time in the future with strong guarantees.
They are the most suitable for critical and time-sensitive applications.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="limitations-of-deferred-calls">Limitations of Deferred Calls<a href="#limitations-of-deferred-calls" class="hash-link" aria-label="Direct link to Limitations of Deferred Calls" title="Direct link to Limitations of Deferred Calls">​</a></h3><p>Contrary to async messages, deferred calls can only be registered up to <code>DEFERRED_CALL_MAX_FUTURE_SLOTS</code> slots in the future.
Their validity conditions are also much more restricted than async calls: only the target slot can be chosen, no other triggers.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="summary-centralized-servers-vs-public-race-vs-async-messages-vs-deferred-calls">Summary: Centralized Servers vs Public race vs Async Messages vs Deferred Calls<a href="#summary-centralized-servers-vs-public-race-vs-async-messages-vs-deferred-calls" class="hash-link" aria-label="Direct link to Summary: Centralized Servers vs Public race vs Async Messages vs Deferred Calls" title="Direct link to Summary: Centralized Servers vs Public race vs Async Messages vs Deferred Calls">​</a></h2><p>Each of the four methods has its own advantages and drawbacks:</p><p><img loading="lazy" alt="Deferred calls vs Async Messages" src="/assets/images/comparison-b68dd53d082d53a3e91f6256f0107ff1.png" width="1401" height="732" class="img_ev3q"></p><p>Typically, Async Messages are perfect to make NFTs evolve over time,
add redundancy on detecting on-chain events in case keepers are down,
and perform cosmetic actions, cleanups and so on...</p><p>Deferred Calls are perfect for critical and time-sensitive applications in which there is no room for failure,
at the cost of lower expressivity.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/massalabs/docs/tree/main/docs/learn/asc/massa-asc.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-04-14T16:37:33.000Z">Apr 14, 2025</time></b> by <b>Peterjah</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/learn/asc/intro"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Introduction</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/learn/decentralized-web"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Decentralized Web</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-clock-massa-is-a-timed-blockchain" class="table-of-contents__link toc-highlight">The clock: Massa is a timed blockchain</a><ul><li><a href="#slots-and-block-execution" class="table-of-contents__link toc-highlight">Slots and block execution</a></li><li><a href="#operations-in-massa" class="table-of-contents__link toc-highlight">Operations in Massa</a></li><li><a href="#having-users-race-for-automation" class="table-of-contents__link toc-highlight">Having users race for automation</a></li></ul></li><li><a href="#async-messages-allowing-smart-contracts-to-emit-operation-like-messages" class="table-of-contents__link toc-highlight">Async messages: allowing smart contracts to emit operation-like messages</a><ul><li><a href="#general-idea" class="table-of-contents__link toc-highlight">General idea</a></li><li><a href="#async-message-structure" class="table-of-contents__link toc-highlight">Async message structure</a></li><li><a href="#the-power-of-async-messages-in-massa" class="table-of-contents__link toc-highlight">The power of Async Messages in Massa</a></li><li><a href="#limitations-of-async-messages" class="table-of-contents__link toc-highlight">Limitations of Async Messages</a></li></ul></li><li><a href="#deferred-calls-scheduling-future-calls-with-guaranteed-execution" class="table-of-contents__link toc-highlight">Deferred calls: scheduling future calls with guaranteed execution</a><ul><li><a href="#general-description" class="table-of-contents__link toc-highlight">General description</a></li><li><a href="#how-are-deferred-calls-scheduled" class="table-of-contents__link toc-highlight">How are deferred calls scheduled?</a></li><li><a href="#step-1-requesting-a-quote" class="table-of-contents__link toc-highlight">Step 1: Requesting a quote</a></li><li><a href="#step-2-registering-a-deferred-call" class="table-of-contents__link toc-highlight">Step 2: Registering a deferred call</a></li><li><a href="#how-are-deferred-calls-executed" class="table-of-contents__link toc-highlight">How are deferred calls executed?</a></li><li><a href="#cancellation" class="table-of-contents__link toc-highlight">Cancellation</a></li><li><a href="#the-power-of-deferred-calls-in-massa" class="table-of-contents__link toc-highlight">The power of Deferred Calls in Massa</a></li><li><a href="#limitations-of-deferred-calls" class="table-of-contents__link toc-highlight">Limitations of Deferred Calls</a></li></ul></li><li><a href="#summary-centralized-servers-vs-public-race-vs-async-messages-vs-deferred-calls" class="table-of-contents__link toc-highlight">Summary: Centralized Servers vs Public race vs Async Messages vs Deferred Calls</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/massa" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/massalabs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://t.me/massanetwork" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/massalabs" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://massa.net" target="_blank" rel="noopener noreferrer" class="footer__link-item">massa.net<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Massa Labs.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.4d3800eb.js"></script>
<script src="/assets/js/main.bf8eda85.js"></script>
</body>
</html>