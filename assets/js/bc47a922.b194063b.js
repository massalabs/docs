"use strict";(self.webpackChunkdocu_dev=self.webpackChunkdocu_dev||[]).push([[6587],{5711:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>r,default:()=>d,frontMatter:()=>i,metadata:()=>l,toc:()=>o});var a=n(4848),t=n(8453);const i={id:"consensus-quality",sidebar_label:"Consensus quality initiatives"},r="Consensus quality initiatives",l={id:"learn/architecture/consensus-quality",title:"Consensus quality initiatives",description:"This section describes the mechanisms we use to maximize the consensus quality on Massa blockchain.",source:"@site/docs/learn/architecture/consensus-quality.mdx",sourceDirName:"learn/architecture",slug:"/learn/architecture/consensus-quality",permalink:"/docs/learn/architecture/consensus-quality",draft:!1,unlisted:!1,editUrl:"https://github.com/massalabs/docs/tree/main/docs/learn/architecture/consensus-quality.mdx",tags:[],version:"current",lastUpdatedBy:"Damir Vodenicarevic",lastUpdatedAt:1723704495e3,frontMatter:{id:"consensus-quality",sidebar_label:"Consensus quality initiatives"},sidebar:"learnSidebar",previous:{title:"Operation lifecycle",permalink:"/docs/learn/architecture/operation-lifecycle"},next:{title:"Tokenomics",permalink:"/docs/learn/tokenomics"}},c={},o=[{value:"Endorsement",id:"endorsement",level:2},{value:"Endorsement structure",id:"endorsement-structure",level:3},{value:"Endorsement lifecycle",id:"endorsement-lifecycle",level:3},{value:"Incentives and penalties",id:"incentives-and-penalties",level:3}];function h(e){const s={annotation:"annotation",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",math:"math",mi:"mi",mn:"mn",mo:"mo",mrow:"mrow",p:"p",pre:"pre",semantics:"semantics",span:"span",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.header,{children:(0,a.jsx)(s.h1,{id:"consensus-quality-initiatives",children:"Consensus quality initiatives"})}),"\n",(0,a.jsx)(s.p,{children:"This section describes the mechanisms we use to maximize the consensus quality on Massa blockchain."}),"\n",(0,a.jsx)(s.h2,{id:"endorsement",children:"Endorsement"}),"\n",(0,a.jsx)(s.p,{children:"Massa uses the Proof-of-Stake selection mechanism with Nakamoto consensus. In that context, when there are multiple cliques\nin close competition, we want all nodes to converge towards a single clique as fast as possible to minimize finality time\nand maximize the quality of the consensus. To achieve this, we draw inspiration from Tezos and introduce the concept of Endorsement."}),"\n",(0,a.jsxs)(s.p,{children:["Each block header in Massa contains ",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsx)(s.mrow,{children:(0,a.jsx)(s.mi,{children:"E"})}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"E"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.6833em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.05764em"},children:"E"})]})})]})," ordered endorsement slots. An endorsement includes the slot it belongs to, the hash\nof the endorsed block, the endorsement slot index, the creator's public key, and a signature. At each slot, a Proof-of-Stake\nselection mechanism chooses the block creator and E other stakers who can create endorsements for that slot. Endorsements can\nbe seen as votes endorsing the parent block in the corresponding thread."]}),"\n",(0,a.jsxs)(s.p,{children:["The attacker's likelihood of consecutive PoS draws decreases exponentially. With endorsements, ",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsxs)(s.mrow,{children:[(0,a.jsx)(s.mi,{children:"E"}),(0,a.jsx)(s.mo,{children:"+"}),(0,a.jsx)(s.mn,{children:"1"})]}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"E+1"})]})})}),(0,a.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.7667em",verticalAlign:"-0.0833em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.05764em"},children:"E"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,a.jsx)(s.span,{className:"mbin",children:"+"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.6444em"}}),(0,a.jsx)(s.span,{className:"mord",children:"1"})]})]})]}),' draws occur at each slot,\nincreasing safety and convergence speed. The consensus algorithm selects the clique with the highest fitness as the blockclique, where\nthe fitness is determined by the number of PoS draws involved in creating the block. This mechanism enhances safety and convergence\nspeed by allowing block producers to select the best clique based on the endorsements\' "votes."']}),"\n",(0,a.jsx)(s.h3,{id:"endorsement-structure",children:"Endorsement structure"}),"\n",(0,a.jsxs)(s.p,{children:["Note that the ",(0,a.jsx)(s.em,{children:"WrappedEndorsement"})," structure includes the underlying ",(0,a.jsx)(s.em,{children:"Endorsement"})," as well as the signature,\nand the public key of the endorsement producer."]}),"\n",(0,a.jsx)(s.p,{children:"Within a block, endorsements are fully included inside the header."}),"\n",(0,a.jsx)(s.p,{children:"A header is invalidated if:"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["it contains strictly more than ",(0,a.jsx)(s.em,{children:"E"})," endorsements"]}),"\n",(0,a.jsx)(s.li,{children:"at least one of the endorsements fails deserialization or signature verification"}),"\n",(0,a.jsx)(s.li,{children:"at least one of the endorsements endorses a block different than the parent of the including block within its own thread"}),"\n",(0,a.jsxs)(s.li,{children:["any of the endorsements should not have been produced at that (",(0,a.jsx)(s.em,{children:"endorsement.slot"}),", ",(0,a.jsx)(s.em,{children:"endorsement.index"}),") according to the selector"]}),"\n",(0,a.jsxs)(s.li,{children:["there is strictly more than one endorsement with a given ",(0,a.jsx)(s.em,{children:"endorsement.index"})]}),"\n"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-rust",children:"pub struct Endorsement {\n  /// slot in which the endorsement can be included\n  pub slot: Slot,\n  /// endorsement index inside the including block\n  pub index: u32,\n  /// Hash of endorsed block.\n  /// This is the parent in thread `self.slot.thread` of the block in which the endorsement is included\n  pub endorsed_block: BlockId,\n}\n"})}),"\n",(0,a.jsx)(s.h3,{id:"endorsement-lifecycle",children:"Endorsement lifecycle"}),"\n",(0,a.jsxs)(s.p,{children:["To create endorsements for a specific slot ",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsx)(s.mrow,{children:(0,a.jsx)(s.mi,{children:"S"})}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"S"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.6833em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.05764em"},children:"S"})]})})]}),", the Endorsement Factory wakes up at a certain timestamp and checks\nthe endorsement producer draws for that slot. The factory asks Consensus for the latest blockclique block with a lower period than S.period to choose the block to endorse.\nThe created endorsements are sent to the Endorsement Pool for future inclusion in blocks and propagated through the\nProtocol to other nodes."]}),"\n",(0,a.jsx)(s.p,{children:"In the Protocol, endorsements can be received from other modules or nodes. Received endorsements are propagated and added\nto the Endorsement Pool if they are not already known. The Endorsement Pool stores a limited number of endorsements that\ncan potentially be included in future blocks. Consensus notifies the Endorsement Pool of newly finalized blocks, allowing\nit to remove endorsements that can only be included in already-finalized slots."}),"\n",(0,a.jsx)(s.p,{children:"When the Block Factory produces a block and needs to include endorsements in its header, it requests the Endorsement Pool\nfor the endorsements that endorse the block's parent in its thread and can be included in the block's slot."}),"\n",(0,a.jsx)(s.h3,{id:"incentives-and-penalties",children:"Incentives and penalties"}),"\n",(0,a.jsxs)(s.p,{children:["To incentivize the creation and endorsement of blocks, as well as the inclusion of endorsements in blocks, a revenue split is implemented. The total revenue generated by a block, denoted as ",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsx)(s.mrow,{children:(0,a.jsx)(s.mi,{children:"R"})}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"R"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.6833em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.00773em"},children:"R"})]})})]}),", is divided into ",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsxs)(s.mrow,{children:[(0,a.jsx)(s.mn,{children:"1"}),(0,a.jsx)(s.mo,{children:"+"}),(0,a.jsx)(s.mi,{children:"E"})]}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"1+E"})]})})}),(0,a.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.7278em",verticalAlign:"-0.0833em"}}),(0,a.jsx)(s.span,{className:"mord",children:"1"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,a.jsx)(s.span,{className:"mbin",children:"+"}),(0,a.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.6833em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.05764em"},children:"E"})]})]})]})," equal parts, where ",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsx)(s.mrow,{children:(0,a.jsx)(s.mi,{children:"E"})}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"E"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.6833em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.05764em"},children:"E"})]})})]})," is the number of endorsements."]}),"\n",(0,a.jsxs)(s.p,{children:["Each part, denoted as ",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsx)(s.mrow,{children:(0,a.jsx)(s.mi,{children:"r"})}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"r"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.4306em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"r"})]})})]}),", is distributed as follows:"]}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["The block creator receives ",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsx)(s.mrow,{children:(0,a.jsx)(s.mi,{children:"r"})}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"r"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"0.4306em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"r"})]})})]})," to motivate block creation, even without endorsements."]}),"\n",(0,a.jsxs)(s.li,{children:["For each successfully included endorsement:","\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["The block creator receives ",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsxs)(s.mrow,{children:[(0,a.jsx)(s.mi,{children:"r"}),(0,a.jsx)(s.mi,{mathvariant:"normal",children:"/"}),(0,a.jsx)(s.mn,{children:"3"})]}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"r/3"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"r"}),(0,a.jsx)(s.span,{className:"mord",children:"/3"})]})})]})," to incentivize endorsement inclusion."]}),"\n",(0,a.jsxs)(s.li,{children:["The endorsement creator receives ",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsxs)(s.mrow,{children:[(0,a.jsx)(s.mi,{children:"r"}),(0,a.jsx)(s.mi,{mathvariant:"normal",children:"/"}),(0,a.jsx)(s.mn,{children:"3"})]}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"r/3"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"r"}),(0,a.jsx)(s.span,{className:"mord",children:"/3"})]})})]})," to motivate endorsement creation."]}),"\n",(0,a.jsxs)(s.li,{children:["The creator of the endorsed block receives ",(0,a.jsxs)(s.span,{className:"katex",children:[(0,a.jsx)(s.span,{className:"katex-mathml",children:(0,a.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,a.jsxs)(s.semantics,{children:[(0,a.jsxs)(s.mrow,{children:[(0,a.jsx)(s.mi,{children:"r"}),(0,a.jsx)(s.mi,{mathvariant:"normal",children:"/"}),(0,a.jsx)(s.mn,{children:"3"})]}),(0,a.jsx)(s.annotation,{encoding:"application/x-tex",children:"r/3"})]})})}),(0,a.jsx)(s.span,{className:"katex-html","aria-hidden":"true",children:(0,a.jsxs)(s.span,{className:"base",children:[(0,a.jsx)(s.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,a.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"r"}),(0,a.jsx)(s.span,{className:"mord",children:"/3"})]})})]})," to encourage timely block emission for endorsement."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(s.p,{children:"This revenue split increases the frequency at which stakers receive coins, reducing the need for staking pools."})]})}function d(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>l});var a=n(6540);const t={},i=a.createContext(t);function r(e){const s=a.useContext(i);return a.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),a.createElement(i.Provider,{value:s},e.children)}}}]);